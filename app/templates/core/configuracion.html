{% extends "base.html" %}

{% block page_header -%}
<div class="page-header d-print-none text-white">
  <div class="container-xl">
    <div class="row g-2 align-items-center">
      <div class="col">
        <!-- Page pre-title -->
        <h1 class="page-title">Configuración</h1>
      </div>
    </div>
  </div>
</div>
{% endblock page_header -%}

{% block page_body %}

<div class="container-xl">
  <!-- BEGIN PAGE BODY -->
  <form method="POST" action="{{ url_for('core.configuracion') }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
    <div class="card">
      <div class="row g-0">
        <div class="col-12 col-md-3 border-end">
          <div class="card-body">
            <h4 class="subheader">Ajustes</h4>
            <nav class="list-group list-group-transparent" data-bs-toggle="tabs">
              <a href="#tab-generales" class="list-group-item list-group-item-action d-flex align-items-center active" data-bs-toggle="tab">Generales</a>
              <a href="#tab-seguridad" class="list-group-item list-group-item-action d-flex align-items-center" data-bs-toggle="tab">Seguridad</a>
              <a href="#tab-limites" class="list-group-item list-group-item-action d-flex align-items-center" data-bs-toggle="tab">Limites</a>
              <a href="#tab-restricciones" class="list-group-item list-group-item-action d-flex align-items-center" data-bs-toggle="tab">Restricciones</a>
            </nav>
            {% if apoderado %}
            <h4 class="subheader mt-4">Alumnos</h4>
            <nav class="list-group list-group-transparent">
              {% for alumno in apoderado.alumnos %}
              <a href="{{ url_for('apoderado_cliente.ficha', id=alumno.id) }}" class="list-group-item list-group-item-action">{{ alumno.nombre }}</a>
              {% endfor %}
            </nav>
            {% endif %}
          </div>
        </div>
        <div class="col-12 col-md-9 d-flex flex-column">
          <div class="card-body">
            <div class="tab-content">
              <div class="tab-pane active show" id="tab-generales">
                <h2 class="mb-4">Generales</h2>
                <h3 class="card-title mt-4">Nombre</h3>
                <div class="row g-3">
                  <div class="col-md">
                    <label class="form-label visually-hidden" for="nombre">Nombre</label>
                    <input type="text" class="form-control" id="nombre" name="nombre" value="{{ apoderado.nombre if apoderado else '' }}" />
                  </div>
                </div>
                <h3 class="card-title mt-4">Telefono</h3>
                <p class="card-subtitle">De preferencia celular, usamos whatsapp.</p>
                <div class="row g-3">
                  <div class="col-md">
                    <label class="form-label visually-hidden" for="phone">Teléfono</label>
                    <input type="text" class="form-control" id="phone" name="phone" value="{{ current_user.username or '' }}" />
                  </div>
                </div>
                <h3 class="card-title mt-4">Correo Electrónico</h3>
                <p class="card-subtitle">Es importante mantener este dato actualizado.</p>
                <div>
                  <div class="row g-2">
                    <div class="col-auto">
                      <label for="email" class="form-label visually-hidden">Email</label>
                      <input type="text" class="form-control w-auto" id="email" name="email" value="{{ current_user.email }}" disabled />
                    </div>
                  </div>
                </div>
                <h3 class="card-title mt-4">Comprobantes de Abono</h3>
                <p class="card-subtitle">Recibir un correo con el comprobante de abono.</p>
                <div>
                  <label class="form-check form-switch form-switch-lg">
                    <input class="form-check-input" type="checkbox" name="comprobantes_transferencia" {% if apoderado and apoderado.comprobantes_transferencia %}checked{% endif %} />
                    <span class="form-check-label form-check-label-on">Quiero recibir el comprobante de esta plataforma.</span>
                    <span class="form-check-label form-check-label-off">Recibiré el comprobante de la pasarela de pago.</span>
                  </label>
                </div>
              </div>
              <div class="tab-pane" id="tab-seguridad">
                <h2 class="mb-4">Seguridad</h2>
                <p>Parámetros de seguridad de uso de la billetera digital.</p>
                <h3 class="card-title mt-4">Notificaciones de Compra</h3>
                <p class="card-subtitle">Recibir una notificación por cada compra realizada.</p>
                <div>
                  <label class="form-check form-switch form-switch-lg">
                    <input class="form-check-input" type="checkbox" name="notificacion_compra" {% if apoderado and apoderado.notificacion_compra %}checked{% endif %} />
                    <span class="form-check-label">Recibir notificaciones de compra</span>
                  </label>
                </div>
                <h3 class="card-title mt-4">Resumen Semanal</h3>
                <p class="card-subtitle">Recibir un resumen semanal de las compras realizadas.</p>
                <div>
                  <label class="form-check form-switch form-switch-lg">
                    <input class="form-check-input" type="checkbox" name="informe_semanal" {% if apoderado and apoderado.informe_semanal %}checked{% endif %} />
                    <span class="form-check-label">Recibir resumen semanal</span>
                  </label>
                </div>
                <h3 class="card-title mt-4">Correo de Copia</h3>
                <p class="card-subtitle">Correo(s) adicionales que recibirán copia de las notificaciones (separados por coma).</p>
                <div class="row g-3">
                  <div class="col-md">
                    <input type="text" class="form-control" name="copia_notificaciones" value="{{ apoderado.copia_notificaciones if apoderado and apoderado.copia_notificaciones else '' }}" placeholder="correo1@ejemplo.com, correo2@ejemplo.com" />
                  </div>
                </div>
              </div>
              <div class="tab-pane" id="tab-limites">
                <h2 class="mb-4">Limites</h2>
                <p>Define los límites de uso de la billetera digital.</p>
                <h3 class="card-title mt-4">Monto Máximo Diario</h3>
                <div class="row g-3">
                  <div class="col-md">
                    <input type="number" class="form-control" name="maximo_diario" value="{{ apoderado.maximo_diario if apoderado and apoderado.maximo_diario else '' }}" placeholder="Sin límite" />
                  </div>
                </div>
                <h3 class="card-title mt-4">Monto Máximo Semanal</h3>
                <div class="row g-3">
                  <div class="col-md">
                    <input type="number" class="form-control" name="maximo_semanal" value="{{ apoderado.maximo_semanal if apoderado and apoderado.maximo_semanal else '' }}" placeholder="Sin límite" />
                  </div>
                </div>
              </div>
              <div class="tab-pane" id="tab-restricciones">
                <h2 class="mb-4">Restricciones</h2>
                Restricciones de compra: Productos específicos, categorías, con ingredientes en particular.
              </div>
            </div>
            <div class="card-footer">
              <button type="submit" class="btn btn-primary">Guardar cambios</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </form>
  <!-- END PAGE BODY -->
</div>
{% endblock page_body %}
