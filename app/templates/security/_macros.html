{% macro field_id(field, sfx='') %}
{% if field and field.id %}
id="{{ field.id }}-{{ sfx }}"
{% endif %}
{% endmacro %}

{% macro render_field_with_errors(field) %}
<div class="fs-div" {{ field_id(field, 'ctr') }}>
  {{ field.label }} {{ field(**kwargs)|safe }}
  {% if field.errors %}
  <ul>
    {% for error in field.errors %}<li class="fs-error-msg">{{ error }}</li>{% endfor %}
  </ul>
  {% endif %}
</div>
{% endmacro %}

{% macro render_field(field) %}
<div class="fs-div" {{ field_id(field, 'ctr') }}>{{ field(**kwargs)|safe }}</div>
{% endmacro %}

{% macro render_field_errors_orig(field) %}
<div class="fs-div" {{ field_id(field, 'ctr') }}>
  {% if field and field.errors %}
  <ul>
    {% for error in field.errors %}<li class="fs-error-msg">{{ error }}</li>{% endfor %}
  </ul>
  {% endif %}
</div>
{% endmacro %}

{% macro render_field_errors(field) %}
{% if field.errors %}
<div class="alert alert-danger mt-1" role="alert" {{ field_id(field, 'ctr') }}>
  <div class="alert-icon">
    <!-- Download SVG icon from http://tabler.io/icons/icon/alert-circle -->
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon alert-icon icon-2">
      <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" />
      <path d="M12 8v4" />
      <path d="M12 16h.01" />
    </svg>
  </div>
  <div>
    <h4 class="alert-heading">Se ha encontrado un error&hellip;</h4>
    <div class="alert-description">
      {% if field and field.errors %}
      <ul>
        {% for error in field.errors %}<li class="fs-error-msg">{{ error }}</li>{% endfor %}
      </ul>
      {% endif %}
    </div>
  </div>
</div>
{% endif %}
{% endmacro %}

{# render WTForms (>3.0) form level errors #}
{% macro render_form_errors(form) %}
{% if form.form_errors %}
<div class="fs-div" id="fs-form-errors">
  <ul>
    {% for error in form.form_errors %}<li class="fs-error-msg">{{ error }}</li>{% endfor %}
  </ul>
</div>
{% endif %}
{% endmacro %}

{% macro prop_next() -%}
{% if 'next' in request.args %}?next={{ request.args.next|urlencode }}{% endif %}
{%- endmacro %}

{# For forms that have multiple POST forms - explicitly render csrf_token so we can change the ID so we don't get duplicates #}
{% macro render_csrf(form, pfx) %}
{% set csrf_field_name = form.meta.csrf_field_name | default %}
{% if form[csrf_field_name] is defined %}
{{ form[csrf_field_name](id=pfx~'-csrf') }}
{% endif %}
{% endmacro %}

{% macro script_nonce() -%}
{% if config["SECURITY_SCRIPT_NONCE_KEY"] and g.get(config["SECURITY_SCRIPT_NONCE_KEY"]) -%}
nonce="{{ g.get(config["SECURITY_SCRIPT_NONCE_KEY"]) }}"
{%- endif %}
{%- endmacro %}
